@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml

title Диаграмма компонентов Device Management Service

Container(api_gateway, "API Gateway", "Node.js/Kong/Nginx", "Точка входа для пользователей и приложений")
Container(user_srv, "User Management Service", "Python", "Аутентификация, авторизация, роли")
ContainerDb(devicedb, "DeviceDB", "PostgreSQL", "БД устройств")

Container_Boundary(device_srv, "Device Management Service", "Python", "Управление устройствами и их привязка") {
    Component(device_api, "Device API", "Flask REST Controller", "Получает и обрабатывает запросы управления устройствами")
    Component(device_service, "DeviceService", "Python Service", "Бизнес-логика управления устройствами")
    Component(device_repo, "DeviceRepository", "SQLAlchemy", "Доступ к базе данных устройств")
    Component(auth_client, "AuthClient", "HTTP Client", "Аутентификация/авторизация через User Management Service")
}

Rel_U(api_gateway, device_api, "Проксирует REST-запросы", "REST")
Rel_L(device_api, device_service, "Вызов методов бизнес-логики")
Rel_D(device_service, device_repo, "Читает/Сохраняет устройства", "SQL")
Rel_D(device_service, auth_client, "Запрашивает профиль/права пользователя", "REST")
Rel(device_repo, devicedb, "SQL")

Rel_U(device_service, api_gateway, "Обменивается данными с другими сервисами", "REST")
Rel(auth_client, user_srv, "REST")

@enduml